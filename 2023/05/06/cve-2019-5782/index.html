<!DOCTYPE html>
<html lang="en">
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    <meta name="description" content="In this post, I will analyze and exploit CVE-2019-5782, a bug caused by the improper implementation of Turbofan, a JIT compiler in V8. We can exploit the mishandling of arguments.length by Turbofan to">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;&#x3D; V8 &lt; 7.3.1)">
<meta property="og:url" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/index.html">
<meta property="og:site_name" content="Aaron&#39;s Note">
<meta property="og:description" content="In this post, I will analyze and exploit CVE-2019-5782, a bug caused by the improper implementation of Turbofan, a JIT compiler in V8. We can exploit the mishandling of arguments.length by Turbofan to">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/1.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/2.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/3.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/4.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/5.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/6.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/7.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/8.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/9.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/10.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/11.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/12.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/13.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/14.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/15.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/16.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/17.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/18.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/19.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/20.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/21.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/22.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/23.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/24.png">
<meta property="og:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/pwn.png">
<meta property="article:published_time" content="2023-05-06T03:00:00.000Z">
<meta property="article:modified_time" content="2025-11-01T12:58:53.751Z">
<meta property="article:author" content="Seongjoon Cho">
<meta property="article:tag" content="chromium">
<meta property="article:tag" content="v8">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TXRLJ2S4LP"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TXRLJ2S4LP');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/07/29/Escaping-V8-Sandbox-via-JIT-Spraying-by-Turbofan-Part-1/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/04/30/v8sbx-ab-2/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&text=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&is_video=false&description=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)&body=Check out this article: https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&name=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&t=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Typing-arguments-length"><span class="toc-number">2.1.</span> <span class="toc-text">Typing arguments.length</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Root-cause"><span class="toc-number">2.2.</span> <span class="toc-text">Root cause</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">3.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Triggering-OOB-using-the-right-shift-operator"><span class="toc-number">3.1.</span> <span class="toc-text">Triggering OOB using the right shift operator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Obtaining-OOB-array"><span class="toc-number">3.2.</span> <span class="toc-text">Obtaining OOB array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-address-of-arbitrary-object"><span class="toc-number">3.3.</span> <span class="toc-text">Getting address of arbitrary object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arbitrary-address-read-write"><span class="toc-number">3.4.</span> <span class="toc-text">Arbitrary address read&#x2F;write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arbitrary-code-execution"><span class="toc-number">3.5.</span> <span class="toc-text">Arbitrary code execution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bisection"><span class="toc-number">4.</span> <span class="toc-text">Bisection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patch"><span class="toc-number">5.</span> <span class="toc-text">Patch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">6.</span> <span class="toc-text">References</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Seongjoon Cho</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-05-06T03:00:00.000Z" class="dt-published" itemprop="datePublished">2023-05-06</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/N-day/">N-day</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/chromium/" rel="tag">chromium</a>, <a class="p-category" href="/tags/v8/" rel="tag">v8</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>In this post, I will analyze and exploit CVE-2019-5782, a bug caused by the improper implementation of Turbofan, a JIT compiler in V8. We can exploit the mishandling of <code>arguments.length</code> by Turbofan to trigger out-of-bounds access and achieve arbitrary code execution.</p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><ul>
<li>Ubuntu 20.04 (WSL)</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/commit/18b28402118b7918512c3e5b6bc5c6f348d43564"><code>18b28402118b7918512c3e5b6bc5c6f348d43564</code></a> (Nov 30, 2018)</li>
</ul>
<p>Run <a href="setup.zsh"><code>setup.zsh</code></a> in the working directory.</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Typing-arguments-length"><a href="#Typing-arguments-length" class="headerlink" title="Typing arguments.length"></a>Typing arguments.length</h3><p><code>arguments.length</code> implies the length of <a target="_blank" rel="external nofollow noopener noreferrer" href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Functions/arguments"><code>arguments</code></a> array.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> <span class="variable language_">arguments</span>.<span class="property">length</span>; &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f</span>()); <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">f</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/05/06/cve-2019-5782/1.png"></p>
<p>The maximum number of arguments of a JavaScript function is defined by <code>Code::kMaxArguments</code> as <code>0xfffe</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/objects/code.h:433-435 */</span></span><br><span class="line"></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kArgumentsBits = <span class="number">16</span>;</span><br><span class="line">  <span class="comment">// Reserve one argument count value as the &quot;don&#x27;t adapt arguments&quot; sentinel.</span></span><br><span class="line">  <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> kMaxArguments = (<span class="number">1</span> &lt;&lt; kArgumentsBits) - <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>Thus, the type of <code>arguments.length</code> is predefined for Turbofan compilation by <code>TypeCache::kArgumentsLengthType</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/type-cache.h:168-170 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// The valid number of arguments for JavaScript functions.</span></span><br><span class="line">  Type <span class="type">const</span> kArgumentsLengthType =</span><br><span class="line">      Type::<span class="built_in">Range</span>(<span class="number">0.0</span>, Code::kMaxArguments, <span class="built_in">zone</span>());</span><br></pre></td></tr></table></figure>

<p>When Turbofan encounters <code>arguments.length</code> while compiling a JavaScript function, it sets the type of the node to <code>TypeCache::kArgumentsLengthType</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% <span class="title class_">OptimizeFunctionOnNextCall</span>(f);</span><br><span class="line"><span class="title function_">f</span>();</span><br></pre></td></tr></table></figure>

<p><img src="/2023/05/06/cve-2019-5782/2.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/3.png"></p>
<h3 id="Root-cause"><a href="#Root-cause" class="headerlink" title="Root cause"></a>Root cause</h3><p>However, we can actually pass more than <code>0xfffe</code> arguments to a JavaScript function. If so, <code>arguments.length</code> is mistyped, eventually leading to type confusion.</p>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><h3 id="Triggering-OOB-using-the-right-shift-operator"><a href="#Triggering-OOB-using-the-right-shift-operator" class="headerlink" title="Triggering OOB using the right shift operator"></a>Triggering OOB using the right shift operator</h3><p><a href="oob.js"><code>oob.js</code></a></p>
<p>The right shift (<code>&gt;&gt;</code>) operator is interpreted as <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/interpreter/interpreter-generator.cc#L1051"><code>ShiftRight</code></a> (or <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/interpreter/interpreter-generator.cc#L1138"><code>ShiftRightSmi</code></a> in case the right operand is an integer) bytecode instruction.</p>
<p><img src="/2023/05/06/cve-2019-5782/4.png"></p>
<p>In <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/compiler/pipeline.cc#L1013"><code>GraphBuilderPhase</code></a> of Turbofan compilation, a <code>SpeculativeNumberShiftRight</code> node is built from the <code>ShiftRight</code> instruction.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/js-type-hint-lowering.cc:131-132 */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> IrOpcode::kJSShiftRight:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">simplified</span>()-&gt;<span class="built_in">SpeculativeNumberShiftRight</span>(hint);</span><br></pre></td></tr></table></figure>

<p>In <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/compiler/pipeline.cc#L1119"><code>TyperPhase</code></a>, <code>SpeculativeNumberShiftRight</code> is typed for the first time. <code>arguments.length</code> is not optimized yet at this point, so a <code>LoadField</code> node responsible for loading <code>arguments.length</code> is passed as the left operand.</p>
<p><img src="/2023/05/06/cve-2019-5782/5.png"></p>
<p>The type is calculated by <code>OperationTyper::NumberShiftRight()</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/operation-typer.cc:959-982 */</span></span><br><span class="line"></span><br><span class="line"><span class="function">Type <span class="title">OperationTyper::NumberShiftRight</span><span class="params">(Type lhs, Type rhs)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">DCHECK</span>(lhs.<span class="built_in">Is</span>(Type::<span class="built_in">Number</span>()));</span><br><span class="line">  <span class="built_in">DCHECK</span>(rhs.<span class="built_in">Is</span>(Type::<span class="built_in">Number</span>()));</span><br><span class="line"></span><br><span class="line">  lhs = <span class="built_in">NumberToInt32</span>(lhs);</span><br><span class="line">  rhs = <span class="built_in">NumberToUint32</span>(rhs);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (lhs.<span class="built_in">IsNone</span>() || rhs.<span class="built_in">IsNone</span>()) <span class="keyword">return</span> Type::<span class="built_in">None</span>();</span><br><span class="line"></span><br><span class="line">  <span class="type">int32_t</span> min_lhs = lhs.<span class="built_in">Min</span>();</span><br><span class="line">  <span class="type">int32_t</span> max_lhs = lhs.<span class="built_in">Max</span>();</span><br><span class="line">  <span class="type">uint32_t</span> min_rhs = rhs.<span class="built_in">Min</span>();</span><br><span class="line">  <span class="type">uint32_t</span> max_rhs = rhs.<span class="built_in">Max</span>();</span><br><span class="line">  <span class="keyword">if</span> (max_rhs &gt; <span class="number">31</span>) &#123;</span><br><span class="line">    <span class="comment">// rhs can be larger than the bitmask</span></span><br><span class="line">    max_rhs = <span class="number">31</span>;</span><br><span class="line">    min_rhs = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">double</span> min = std::<span class="built_in">min</span>(min_lhs &gt;&gt; min_rhs, min_lhs &gt;&gt; max_rhs);</span><br><span class="line">  <span class="type">double</span> max = std::<span class="built_in">max</span>(max_lhs &gt;&gt; min_rhs, max_lhs &gt;&gt; max_rhs);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (max == kMaxInt &amp;&amp; min == kMinInt) <span class="keyword">return</span> Type::<span class="built_in">Signed32</span>();</span><br><span class="line">  <span class="keyword">return</span> Type::<span class="built_in">Range</span>(min, max, <span class="built_in">zone</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It sets <code>min</code> to the smaller of <code>min_lhs &gt;&gt; min_rhs</code> and <code>min_lhs &gt;&gt; max_rhs</code>, and sets <code>max</code> to the larger of <code>max_lhs &gt;&gt; min_rhs</code> and <code>max_lhs &gt;&gt; max_rhs</code>.</p>
<p><img src="/2023/05/06/cve-2019-5782/6.png"></p>
<p>As a result, the initial type of <code>SpeculativeNumberShiftRight</code> is set to <code>Range(-32768, 32767)</code>.</p>
<p><img src="/2023/05/06/cve-2019-5782/7.png"></p>
<p>In <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/compiler/pipeline.cc#L1192"><code>TypedLoweringPhase</code></a>, <code>JSCreateArguments</code> is reduced by <code>JSCreateLowering::ReduceJSCreateArguments()</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/js-create-lowering.cc:209-217 */</span></span><br><span class="line"></span><br><span class="line">        a.<span class="built_in">Allocate</span>(JSSloppyArgumentsObject::kSize);</span><br><span class="line">        a.<span class="built_in">Store</span>(AccessBuilder::<span class="built_in">ForMap</span>(), arguments_map);</span><br><span class="line">        a.<span class="built_in">Store</span>(AccessBuilder::<span class="built_in">ForJSObjectPropertiesOrHash</span>(), properties);</span><br><span class="line">        a.<span class="built_in">Store</span>(AccessBuilder::<span class="built_in">ForJSObjectElements</span>(), elements);</span><br><span class="line">        a.<span class="built_in">Store</span>(AccessBuilder::<span class="built_in">ForArgumentsLength</span>(), arguments_length);</span><br><span class="line">        a.<span class="built_in">Store</span>(AccessBuilder::<span class="built_in">ForArgumentsCallee</span>(), callee);</span><br><span class="line">        <span class="built_in">RelaxControls</span>(node);</span><br><span class="line">        a.<span class="built_in">FinishAndChange</span>(node);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Changed</span>(node);</span><br></pre></td></tr></table></figure>

<p>The nodes responsible for storing <code>arguments_map</code>, <code>properties</code>, <code>elements</code>, <code>arguments_length</code> and <code>callee</code> are created, and <code>JSCreateArguments</code> is converted to a <code>FinishRegion</code> node by <code>AllocationBuilder::FinishAndChange()</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/allocation-builder.h:67-73 */</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">FinishAndChange</span><span class="params">(Node* node)</span> </span>&#123;</span><br><span class="line">    NodeProperties::<span class="built_in">SetType</span>(allocation_, NodeProperties::<span class="built_in">GetType</span>(node));</span><br><span class="line">    node-&gt;<span class="built_in">ReplaceInput</span>(<span class="number">0</span>, allocation_);</span><br><span class="line">    node-&gt;<span class="built_in">ReplaceInput</span>(<span class="number">1</span>, effect_);</span><br><span class="line">    node-&gt;<span class="built_in">TrimInputCount</span>(<span class="number">2</span>);</span><br><span class="line">    NodeProperties::<span class="built_in">ChangeOp</span>(node, <span class="built_in">common</span>()-&gt;<span class="built_in">FinishRegion</span>());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/05/06/cve-2019-5782/8.png"></p>
<p>In <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/compiler/pipeline.cc#L1400"><code>LoadEliminationPhase</code></a>, <code>LoadField</code> is reduced by <code>LoadElimination::ReduceLoadField()</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/load-elimination.cc:114-115 */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> IrOpcode::kLoadField:</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">ReduceLoadField</span>(node);</span><br></pre></td></tr></table></figure>

<p>The output of <code>LoadField</code>, which is the length of the <code>arguments</code> object, already exists in the graph as an <code>ArgumentsLength</code> node.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/load-elimination.cc:807-825 */</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (Node* replacement = state-&gt;<span class="built_in">LookupField</span>(object, field_index)) &#123;</span><br><span class="line">        <span class="comment">// Make sure we don&#x27;t resurrect dead &#123;replacement&#125; nodes.</span></span><br><span class="line">        <span class="keyword">if</span> (!replacement-&gt;<span class="built_in">IsDead</span>()) &#123;</span><br><span class="line">          <span class="comment">// Introduce a TypeGuard if the type of the &#123;replacement&#125; node is not</span></span><br><span class="line">          <span class="comment">// a subtype of the original &#123;node&#125;&#x27;s type.</span></span><br><span class="line">          <span class="keyword">if</span> (!NodeProperties::<span class="built_in">GetType</span>(replacement)</span><br><span class="line">                   .<span class="built_in">Is</span>(NodeProperties::<span class="built_in">GetType</span>(node))) &#123;</span><br><span class="line">            Type replacement_type = Type::<span class="built_in">Intersect</span>(</span><br><span class="line">                NodeProperties::<span class="built_in">GetType</span>(node),</span><br><span class="line">                NodeProperties::<span class="built_in">GetType</span>(replacement), <span class="built_in">graph</span>()-&gt;<span class="built_in">zone</span>());</span><br><span class="line">            replacement = effect =</span><br><span class="line">                <span class="built_in">graph</span>()-&gt;<span class="built_in">NewNode</span>(<span class="built_in">common</span>()-&gt;<span class="built_in">TypeGuard</span>(replacement_type),</span><br><span class="line">                                 replacement, effect, control);</span><br><span class="line">            NodeProperties::<span class="built_in">SetType</span>(replacement, replacement_type);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">ReplaceWithValue</span>(node, replacement, effect);</span><br><span class="line">          <span class="keyword">return</span> <span class="built_in">Replace</span>(replacement);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p><code>LoadElimination::ReduceLoadField()</code> looks for the <code>ArgumentsLength</code> from the graph, and replaces the current <code>LoadField</code> with the existing <code>ArgumentsLength</code>.</p>
<p><img src="/2023/05/06/cve-2019-5782/9.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/10.png"></p>
<p>In <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/blob/18b28402118b7918512c3e5b6bc5c6f348d43564/src/compiler/pipeline.cc#L1245"><code>SimplifiedLoweringPhase</code></a>, <code>SpeculativeNumberShiftRight</code> is typed again by <code>OperationTyper::NumberShiftRight()</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/simplified-lowering.cc:451-458 */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECLARE_CASE(Name)                                               \</span></span><br><span class="line"><span class="meta">  case IrOpcode::k##Name: &#123;                                              \</span></span><br><span class="line"><span class="meta">    new_type = Type::Intersect(op_typer_.Name(input0_type, input1_type), \</span></span><br><span class="line"><span class="meta">                               info-&gt;restriction_type(), graph_zone());  \</span></span><br><span class="line"><span class="meta">    break;                                                               \</span></span><br><span class="line"><span class="meta">  &#125;</span></span><br><span class="line">      <span class="built_in">SIMPLIFIED_SPECULATIVE_NUMBER_BINOP_LIST</span>(DECLARE_CASE)</span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> DECLARE_CASE</span></span><br></pre></td></tr></table></figure>

<p>The logic is the same as in <code>TyperPhase</code>,  but the type of left input node is <code>TypeCache::kArgumentsLengthType</code> at this time, resulting in both <code>min</code> and <code>max</code> being 0.</p>
<p><img src="/2023/05/06/cve-2019-5782/11.png"></p>
<p>The result of <code>SpeculativeNumberShiftRight</code> is used as <code>idx</code> to get an element from <code>arr</code>.</p>
<p><img src="/2023/05/06/cve-2019-5782/12.png"></p>
<p>There’s a <code>CheckBounds</code> node responsible for preventing out-of-bounds. It takes the index as the first input and the array length as the second, and checks whether the index is less than the length. Also in <code>SimplifiedLoweringPhase</code>, the <code>CheckBounds</code> is reduced by <code>RepresentationSelector::VisitCheckBounds()</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/compiler/simplified-lowering.cc:1535-1546 */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (lowering-&gt;poisoning_level_ ==</span><br><span class="line">                  PoisoningMitigationLevel::kDontPoison &amp;&amp;</span><br><span class="line">              (index_type.<span class="built_in">IsNone</span>() || length_type.<span class="built_in">IsNone</span>() ||</span><br><span class="line">               (index_type.<span class="built_in">Min</span>() &gt;= <span class="number">0.0</span> &amp;&amp;</span><br><span class="line">                index_type.<span class="built_in">Max</span>() &lt; length_type.<span class="built_in">Min</span>()))) &#123;</span><br><span class="line">            <span class="comment">// The bounds check is redundant if we already know that</span></span><br><span class="line">            <span class="comment">// the index is within the bounds of [0.0, length[.</span></span><br><span class="line">            <span class="built_in">DeferReplacement</span>(node, node-&gt;<span class="built_in">InputAt</span>(<span class="number">0</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            NodeProperties::<span class="built_in">ChangeOp</span>(</span><br><span class="line">                node, <span class="built_in">simplified</span>()-&gt;<span class="built_in">CheckedUint32Bounds</span>(p.<span class="built_in">feedback</span>()));</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>

<p>In case <code>index_type.Max()</code> is smaller than <code>length_type.Min()</code>, there’s no possibility of out-of-bounds, so <code>VisitCheckBounds()</code> calls <code>RepresentationSelector::DeferReplacement()</code> to remove <code>CheckBounds</code>.</p>
<p><img src="/2023/05/06/cve-2019-5782/13.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/14.png"></p>
<p>After compilation is finished, <code>f()</code> takes <code>0x10000</code> arguments, but Turbofan didn’t consider it possible. The bounds check was already removed because Turbofan assumed that <code>idx</code> is always 0. However, <code>idx</code> becomes 1 this time, so we can access the out-of-bounds of <code>arr</code> and read the value at the location corresponding to <code>arr[1]</code>.</p>
<p><img src="/2023/05/06/cve-2019-5782/15.png"></p>
<h3 id="Obtaining-OOB-array"><a href="#Obtaining-OOB-array" class="headerlink" title="Obtaining OOB array"></a>Obtaining OOB array</h3><p>We can access the length field of an array using OOB.</p>
<p><img src="/2023/05/06/cve-2019-5782/16.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/17.png"></p>
<p>We can overwrite the length field of the array with a larger value, without extending the elements array.</p>
<p><img src="/2023/05/06/cve-2019-5782/18.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/19.png"></p>
<p>Via this corrupted array, we can access elements beyond the bounds of the array, such as <code>arr[100]</code>, which should be <code>undefined</code> under normal circumstances.</p>
<p><img src="/2023/05/06/cve-2019-5782/20.png"></p>
<h3 id="Getting-address-of-arbitrary-object"><a href="#Getting-address-of-arbitrary-object" class="headerlink" title="Getting address of arbitrary object"></a>Getting address of arbitrary object</h3><p>An array containing JavaScript objects holds their addresses in its memory.</p>
<p><img src="/2023/05/06/cve-2019-5782/21.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/22.png"></p>
<p>We can place an array of objects right behind the OOB array we obtained above, and read the value stored in the array of objects via the OOB array, so that we can get the address of an arbitrary object in the form of a floating-point number.</p>
<h3 id="Arbitrary-address-read-write"><a href="#Arbitrary-address-read-write" class="headerlink" title="Arbitrary address read&#x2F;write"></a>Arbitrary address read&#x2F;write</h3><p><code>JSTypedArray</code> has a <code>FixedTypedArrayBase</code> object in its elements field.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/objects/fixed-array.h:575-583 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FixedTypedArrayBase</span> : <span class="keyword">public</span> FixedArrayBase &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="comment">// [base_pointer]: Either points to the FixedTypedArrayBase itself or nullptr.</span></span><br><span class="line">  <span class="built_in">DECL_ACCESSORS</span>(base_pointer, Object);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// [external_pointer]: Contains the offset between base_pointer and the start</span></span><br><span class="line">  <span class="comment">// of the data. If the base_pointer is a nullptr, the external_pointer</span></span><br><span class="line">  <span class="comment">// therefore points to the actual backing store.</span></span><br><span class="line">  <span class="built_in">DECL_ACCESSORS</span>(external_pointer, <span class="type">void</span>)</span><br></pre></td></tr></table></figure>

<p><code>FixedTypedArrayBase</code> has a <code>base_pointer</code> that points to itself, and an <code>external_pointer</code> that indicates the distance between the <code>base_pointer</code> and the actual data.</p>
<p><img src="/2023/05/06/cve-2019-5782/23.png"></p>
<p><img src="/2023/05/06/cve-2019-5782/24.png"></p>
<p>We can place a <code>JSTypedArray</code> right behind the OOB array we obtained above, and overwrite <code>base_pointer</code> and <code>external_pointer</code> with an arbitrary address and 0, respectively. Then, we can read the value at the address via that array, and any value we store in that array would be written to that address.</p>
<h3 id="Arbitrary-code-execution"><a href="#Arbitrary-code-execution" class="headerlink" title="Arbitrary code execution"></a>Arbitrary code execution</h3><blockquote>
<a href="/2023/04/29/v8sbx-ab-1/" title="Escaping V8 Sandbox via Backing Store of ArrayBuffer and WebAssembly Code Space: Part 1 (V8 &lt; 10.0.138)"><p>Escaping V8 Sandbox via Backing Store of ArrayBuffer and WebAssembly Code Space: Part 1 (V8 < 10.0.138)</p></a></blockquote>
<p><a href="pwn.wat"><code>pwn.wat</code></a> <a href="shellcode.py"><code>shellcode.py</code></a> <a href="pwn.js"><code>pwn.js</code></a></p>
<p><img src="/2023/05/06/cve-2019-5782/pwn.png"></p>
<h2 id="Bisection"><a href="#Bisection" class="headerlink" title="Bisection"></a>Bisection</h2><blockquote>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/commit/bac7dad666ae203e04b5ff68d838ed2ea5f03e26">[Build] Disable build-time untrusted code mitigations on non-Android platforms and ia32.</a> (Oct 18, 2018)</p>
<p>Non-Android platforms are protected in Chrome by site isolation, therefore we can disable the untrusted code mitigations. We still enable them on Android, and on simulator builds since that is where we do much of the correctness testing for Android.</p>
</blockquote>
<h2 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h2><blockquote>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/commit/4e3a17d0408627517d4a81b3bf5daf85e416e9ac">[runtime] Reduce spread&#x2F;apply call max arguments</a> (Nov 22, 2018)</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/commit/ff0cf00c72c2b7e12f6e15a575604c8a26ab4364">Revert “[runtime] Reduce spread&#x2F;apply call max arguments”</a> (Nov 30, 2018)</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/v8/v8/commit/8e4588915ba7a9d9d744075781cea114d49f0c7b">[turbofan] Relax range for arguments object length</a> (Nov 30, 2018)</p>
</blockquote>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://chromereleases.googleblog.com/2019/01/stable-channel-update-for-desktop.html">Stable Channel Update for Desktop (Tuesday, January 29, 2019) - Chrome Releases</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://issues.chromium.org/issues/40093090">Security: Tianfu CUP RCE - Chromium Issues</a></li>
</ul>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Typing-arguments-length"><span class="toc-number">2.1.</span> <span class="toc-text">Typing arguments.length</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Root-cause"><span class="toc-number">2.2.</span> <span class="toc-text">Root cause</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">3.</span> <span class="toc-text">Exploitation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Triggering-OOB-using-the-right-shift-operator"><span class="toc-number">3.1.</span> <span class="toc-text">Triggering OOB using the right shift operator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Obtaining-OOB-array"><span class="toc-number">3.2.</span> <span class="toc-text">Obtaining OOB array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getting-address-of-arbitrary-object"><span class="toc-number">3.3.</span> <span class="toc-text">Getting address of arbitrary object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arbitrary-address-read-write"><span class="toc-number">3.4.</span> <span class="toc-text">Arbitrary address read&#x2F;write</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arbitrary-code-execution"><span class="toc-number">3.5.</span> <span class="toc-text">Arbitrary code execution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bisection"><span class="toc-number">4.</span> <span class="toc-text">Bisection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patch"><span class="toc-number">5.</span> <span class="toc-text">Patch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">6.</span> <span class="toc-text">References</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&text=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&is_video=false&description=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)&body=Check out this article: https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&title=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&name=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://aaronsjcho.github.io/2023/05/06/cve-2019-5782/&t=CVE-2019-5782: Improper Typing for arguments.length by Turbofan Leading to RCE (7.2.41 &lt;= V8 &lt; 7.3.1)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2025
    Seongjoon Cho
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'">


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'aaronsjcho/aaronsjcho.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
