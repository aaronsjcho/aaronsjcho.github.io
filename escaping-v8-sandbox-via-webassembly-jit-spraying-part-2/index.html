<!DOCTYPE html>
<html lang="en">
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    <meta name="description" content="Escaping V8 Sandbox via WebAssembly JIT Spraying (V8 &lt; 10.6.24) Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;&#x3D; V8 &lt; 12.2.170)  TODO Setup Ubuntu 22.04 8cf17a14a78cc">
<meta property="og:type" content="article">
<meta property="og:title" content="Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;&#x3D; V8 &lt; 12.2.170)">
<meta property="og:url" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/index.html">
<meta property="og:site_name" content="Aaron&#39;s Note">
<meta property="og:description" content="Escaping V8 Sandbox via WebAssembly JIT Spraying (V8 &lt; 10.6.24) Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;&#x3D; V8 &lt; 12.2.170)  TODO Setup Ubuntu 22.04 8cf17a14a78cc">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/1.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/2.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/3.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/4.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/5.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/6.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/7.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/8.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/9.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/10.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/11.png">
<meta property="og:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/pwn.png">
<meta property="article:published_time" content="2024-02-04T03:00:00.000Z">
<meta property="article:modified_time" content="2026-02-07T11:41:53.606Z">
<meta property="article:author" content="Seongjoon (Aaron) Cho">
<meta property="article:tag" content="browser">
<meta property="article:tag" content="chromium">
<meta property="article:tag" content="v8">
<meta property="article:tag" content="v8sbx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TXRLJ2S4LP"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TXRLJ2S4LP');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 8.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/escaping-v8-sandbox-via-webassembly-jit-spraying/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&text=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&is_video=false&description=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)&body=Check out this article: https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&name=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&t=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Calling-WebAssembly-Function"><span class="toc-number">2.1.</span> <span class="toc-text">Calling WebAssembly Function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebAssembly-Lazy-Compilation"><span class="toc-number">2.2.</span> <span class="toc-text">WebAssembly Lazy Compilation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">3.</span> <span class="toc-text">Exploitation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bisection"><span class="toc-number">4.</span> <span class="toc-text">Bisection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patch"><span class="toc-number">5.</span> <span class="toc-text">Patch</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Seongjoon (Aaron) Cho</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-02-04T03:00:00.000Z" class="dt-published" itemprop="datePublished">2024-02-04</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/n-day/">n-day</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/browser/" rel="tag">browser</a>, <a class="p-category" href="/tags/chromium/" rel="tag">chromium</a>, <a class="p-category" href="/tags/v8/" rel="tag">v8</a>, <a class="p-category" href="/tags/v8sbx/" rel="tag">v8sbx</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <ol>
<li><a href="/escaping-v8-sandbox-via-webassembly-jit-spraying/" title="Escaping V8 Sandbox via WebAssembly JIT Spraying (V8 &lt; 10.6.24)">Escaping V8 Sandbox via WebAssembly JIT Spraying (V8 &lt; 10.6.24)</a></li>
<li><strong><a href="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/" title="Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;&#x3D; V8 &lt; 12.2.170)">Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;&#x3D; V8 &lt; 12.2.170)</a></strong></li>
</ol>
<p><em>TODO</em></p>
<h2 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h2><ul>
<li>Ubuntu 22.04</li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://chromium.googlesource.com/v8/v8.git/+/8cf17a14a78cc1276eb42e1b4bb699f705675530"><code>8cf17a14a78cc1276eb42e1b4bb699f705675530</code></a> (Jan 4, 2024)</li>
</ul>
<p>Run <a href="v8setup.py"><code>v8setup.py</code></a> in your working directory.</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><h3 id="Calling-WebAssembly-Function"><a href="#Calling-WebAssembly-Function" class="headerlink" title="Calling WebAssembly Function"></a>Calling WebAssembly Function</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">d8.<span class="property">file</span>.<span class="title function_">execute</span>(<span class="string">&quot;v8/test/mjsunit/wasm/wasm-module-builder.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> builder = <span class="keyword">new</span> <span class="title class_">WasmModuleBuilder</span>();</span><br><span class="line"></span><br><span class="line">builder.<span class="title function_">addFunction</span>(<span class="string">&quot;f&quot;</span>, <span class="title function_">makeSig</span>([], [])).<span class="title function_">addBody</span>([]).<span class="title function_">exportFunc</span>();</span><br><span class="line">builder.<span class="title function_">addFunction</span>(<span class="string">&quot;g&quot;</span>, <span class="title function_">makeSig</span>([], [])).<span class="title function_">addBody</span>([]);</span><br><span class="line">builder.<span class="title function_">addFunction</span>(<span class="string">&quot;h&quot;</span>, <span class="title function_">makeSig</span>([], [])).<span class="title function_">addBody</span>([]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> instance = builder.<span class="title function_">instantiate</span>();</span><br><span class="line"></span><br><span class="line">instance.<span class="property">exports</span>.<span class="title function_">f</span>();</span><br></pre></td></tr></table></figure>

<p>The JavaScript code above creates a WebAssembly module containing three functions, and calls the first one.</p>
<p>The JavaScript function call is handled by <code>Builtins_CallFunction_ReceiverIsAny()</code>, which is generated by <code>Builtins::Generate_CallFunction_ReceiverIsAny()</code>.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;builtins-call-gen.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Builtins::Generate_CallFunction_ReceiverIsAny</span><span class="params">(MacroAssembler* masm)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Generate_CallFunction</span>(masm, ConvertReceiverMode::kAny);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;x64&#x2F;builtins-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------- S t a t e -------------</span></span><br><span class="line"><span class="comment">//  -- rax : the number of arguments</span></span><br><span class="line"><span class="comment">//  -- rdx : the shared function info.</span></span><br><span class="line"><span class="comment">//  -- rdi : the function to call (checked to be a JSFunction)</span></span><br><span class="line"><span class="comment">//  -- rsi : the function context.</span></span><br><span class="line"><span class="comment">// -----------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="function">__ <span class="title">movzxwq</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    rbx, FieldOperand(rdx, SharedFunctionInfo::kFormalParameterCountOffset))</span></span>;</span><br><span class="line marked"><span class="function">__ <span class="title">InvokeFunctionCode</span><span class="params">(rdi, no_reg, rbx, rax, InvokeType::kJump)</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>Builtins::Generate_CallFunction()</code> calls <code>MacroAssembler::InvokeFunctionCode()</code> to generate the function invocation sequence.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;codegen&#x2F;x64&#x2F;macro-assembler-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">3489</span><br><span class="line">3490</span><br><span class="line">3491</span><br><span class="line">3492</span><br><span class="line">3493</span><br><span class="line">3494</span><br><span class="line">3495</span><br><span class="line">3496</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (type) &#123;</span><br><span class="line">  <span class="keyword">case</span> InvokeType::kCall:</span><br><span class="line">    <span class="built_in">CallJSFunction</span>(function);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> InvokeType::kJump:</span><br><span class="line marked">    <span class="built_in">JumpJSFunction</span>(function);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MacroAssembler::InvokeFunctionCode()</code> calls <code>MacroAssembler::JumpJSFunction()</code> if <code>type</code> is <code>InvokeType::kJump</code>.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;codegen&#x2F;x64&#x2F;macro-assembler-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">2813</span><br><span class="line">2814</span><br><span class="line">2815</span><br><span class="line">2816</span><br><span class="line">2817</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// When the sandbox is enabled, we can directly fetch the entrypoint pointer</span></span><br><span class="line"><span class="comment">// from the code pointer table instead of going through the Code object. In</span></span><br><span class="line"><span class="comment">// this way, we avoid one memory load on this code path.</span></span><br><span class="line"><span class="built_in">LoadCodeEntrypointViaCodePointer</span>(</span><br><span class="line">    rcx, <span class="built_in">FieldOperand</span>(function_object, JSFunction::kCodeOffset));</span><br></pre></td></tr></table></figure>

<p><code>MacroAssembler::JumpJSFunction()</code> calls <code>MacroAssembler::LoadCodeEntrypointViaCodePointer()</code> to emit instructions that fetch the entrypoint pointer.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;objects&#x2F;js-function.tq</span></figcaption><table><tr><td class="gutter"><pre><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This class does not use the generated verifier, so if you change anything</span></span><br><span class="line"><span class="comment">// here, please also update JSFunctionVerify in objects-debug.cc.</span></span><br><span class="line">@highestInstanceTypeWithinParentClassRange</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">class</span> <span class="title class_">JSFunction</span> extends JSFunctionOrBoundFunctionOrWrappedFunction &#123;</span><br><span class="line">  <span class="comment">// When the sandbox is enabled, the Code object is referenced through an</span></span><br><span class="line">  <span class="comment">// indirect pointer. Otherwise, it is a regular tagged pointer.</span></span><br><span class="line marked">  @<span class="keyword">if</span>(V8_ENABLE_SANDBOX) code: IndirectPointer&lt;Code&gt;;</span><br><span class="line">  @ifnot(V8_ENABLE_SANDBOX) code: Code;</span><br><span class="line">  shared_function_info: SharedFunctionInfo;</span><br><span class="line">  context: Context;</span><br><span class="line">  feedback_cell: FeedbackCell;</span><br><span class="line">  <span class="comment">// Space for the following field may or may not be allocated.</span></span><br><span class="line">  prototype_or_initial_map: JSReceiver|Map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>include&#x2F;v8-internal.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Code pointer handles are shifted by a different amount than indirect pointer</span></span><br><span class="line"><span class="comment">// handles as the tables have a different maximum size.</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">uint32_t</span> kCodePointerHandleShift = <span class="number">12</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>include&#x2F;v8-internal.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">600</span><br><span class="line">601</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> kCodePointerTableEntrySize = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> kCodePointerTableEntrySizeLog2 = <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>src&#x2F;codegen&#x2F;x64&#x2F;macro-assembler-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MacroAssembler::LoadCodeEntrypointViaCodePointer</span><span class="params">(Register destination,</span></span></span><br><span class="line"><span class="params"><span class="function">                                                      Operand field_operand)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">DCHECK</span>(!<span class="built_in">AreAliased</span>(destination, kScratchRegister));</span><br><span class="line">  <span class="built_in">DCHECK</span>(!field_operand.<span class="built_in">AddressUsesRegister</span>(kScratchRegister));</span><br><span class="line">  <span class="built_in">LoadAddress</span>(kScratchRegister,</span><br><span class="line">              ExternalReference::<span class="built_in">code_pointer_table_address</span>());</span><br><span class="line">  <span class="built_in">movl</span>(destination, field_operand);</span><br><span class="line">  <span class="built_in">shrl</span>(destination, <span class="built_in">Immediate</span>(kCodePointerHandleShift));</span><br><span class="line">  <span class="built_in">shll</span>(destination, <span class="built_in">Immediate</span>(kCodePointerTableEntrySizeLog2));</span><br><span class="line">  <span class="built_in">movq</span>(destination, <span class="built_in">Operand</span>(kScratchRegister, destination, times_1, <span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/1.png"></p>
<p><code>Builtins_CallFunction_ReceiverIsAny()</code> reads the code pointer handle stored in the <code>code</code> field of the <code>Function</code> object. It converts the handle into an index to access the corresponding entry of the function in the code pointer table.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;sandbox&#x2F;code-pointer-table.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line marked">std::atomic&lt;Address&gt; entrypoint_;</span><br><span class="line"><span class="comment">// The pointer to the Code object also contains the marking bit: since this is</span></span><br><span class="line"><span class="comment">// a tagged pointer to a V8 HeapObject, we know that it will be 4-byte aligned</span></span><br><span class="line"><span class="comment">// and that the LSB should always be set. We therefore use the LSB as marking</span></span><br><span class="line"><span class="comment">// bit. In this way:</span></span><br><span class="line"><span class="comment">//  - When loading the pointer, we only need to perform an unconditional OR 1</span></span><br><span class="line"><span class="comment">//  to get the correctly tagged pointer</span></span><br><span class="line"><span class="comment">//  - When storing the pointer we don&#x27;t need to do anything since the tagged</span></span><br><span class="line"><span class="comment">//  pointer will automatically be marked</span></span><br><span class="line">std::atomic&lt;Address&gt; code_;</span><br></pre></td></tr></table></figure>

<p>The <code>CodePointerTableEntry</code> class has two fields: <code>entrypoint_</code> and <code>code_</code>. The <code>entrypoint_</code> field holds the entrypoint address, and the <code>code_</code> field holds the address of the <code>Code</code> object corresponding to the function.</p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/2.png"></p>
<figure class="highlight c++"><figcaption><span>src&#x2F;codegen&#x2F;x64&#x2F;macro-assembler-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">2818</span><br><span class="line">2819</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DCHECK_EQ</span>(jump_mode, JumpMode::kJump);</span><br><span class="line"><span class="built_in">jmp</span>(rcx);</span><br></pre></td></tr></table></figure>

<p>After getting the entrypoint address, <code>Builtins_CallFunction_ReceiverIsAny()</code> jumps to that address, where the generic JS-to-Wasm wrapper starts.</p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/3.png"></p>
<p><code>Builtins_JSToWasmWrapper()</code> calls <code>Builtins_JSToWasmWrapperAsm()</code> generated by <code>Builtins::Generate_JSToWasmWrapperAsm()</code>.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;x64&#x2F;builtins-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">3664</span><br><span class="line">3665</span><br><span class="line">3666</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Builtins::Generate_JSToWasmWrapperAsm</span><span class="params">(MacroAssembler* masm)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">JSToWasmWrapperHelper</span>(masm, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;x64&#x2F;builtins-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">3534</span><br><span class="line">3535</span><br><span class="line">3536</span><br><span class="line">3537</span><br><span class="line">3538</span><br><span class="line">3539</span><br><span class="line">3540</span><br><span class="line">3541</span><br><span class="line">3542</span><br><span class="line">3543</span><br><span class="line">3544</span><br><span class="line">3545</span><br><span class="line">3546</span><br></pre></td><td class="code"><pre><span class="line marked">Register call_target = rdi;</span><br><span class="line"><span class="comment">// param_start should not alias with any parameter registers.</span></span><br><span class="line marked">Register params_start = r11;</span><br><span class="line"><span class="function">__ <span class="title">movq</span><span class="params">(params_start,</span></span></span><br><span class="line"><span class="params"><span class="function">        MemOperand(wrapper_buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">                   JSToWasmWrapperFrameConstants::kWrapperBufferParamStart))</span></span>;</span><br><span class="line marked">Register params_end = rbx;</span><br><span class="line"><span class="function">__ <span class="title">movq</span><span class="params">(params_end,</span></span></span><br><span class="line"><span class="params"><span class="function">        MemOperand(wrapper_buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">                   JSToWasmWrapperFrameConstants::kWrapperBufferParamEnd))</span></span>;</span><br><span class="line"><span class="function">__ <span class="title">movq</span><span class="params">(call_target,</span></span></span><br><span class="line"><span class="params"><span class="function">        MemOperand(wrapper_buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">                   JSToWasmWrapperFrameConstants::kWrapperBufferCallTarget))</span></span>;</span><br></pre></td></tr></table></figure>

<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/4.png"></p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/5.png"></p>
<p><code>Builtins_JSToWasmWrapperAsm()</code> loads the call target address into <code>rdi</code>, the parameter start address into <code>r11</code>, and the parameter end address into <code>rbx</code>.</p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/6.png"></p>
<p>The call target points to the jump table entry corresponding to the invoked WebAssembly function.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;wasm&#x2F;wasm-linkage.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">elif</span> V8_TARGET_ARCH_X64</span></span><br><span class="line"><span class="comment">// ===========================================================================</span></span><br><span class="line"><span class="comment">// == x64 ====================================================================</span></span><br><span class="line"><span class="comment">// ===========================================================================</span></span><br><span class="line marked"><span class="keyword">constexpr</span> Register kGpParamRegisters[] = &#123;rsi, rax, rdx, rcx, rbx, r9&#125;;</span><br><span class="line"><span class="keyword">constexpr</span> Register kGpReturnRegisters[] = &#123;rax, rdx&#125;;</span><br><span class="line marked"><span class="keyword">constexpr</span> DoubleRegister kFpParamRegisters[] = &#123;xmm1, xmm2, xmm3,</span><br><span class="line marked">                                                xmm4, xmm5, xmm6&#125;;</span><br><span class="line"><span class="keyword">constexpr</span> DoubleRegister kFpReturnRegisters[] = &#123;xmm1, xmm2&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;x64&#x2F;builtins-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">3571</span><br><span class="line">3572</span><br><span class="line">3573</span><br><span class="line">3574</span><br><span class="line">3575</span><br><span class="line">3576</span><br><span class="line">3577</span><br><span class="line">3578</span><br><span class="line">3579</span><br><span class="line">3580</span><br><span class="line">3581</span><br><span class="line">3582</span><br><span class="line">3583</span><br><span class="line">3584</span><br><span class="line">3585</span><br><span class="line">3586</span><br><span class="line">3587</span><br><span class="line">3588</span><br><span class="line">3589</span><br><span class="line">3590</span><br><span class="line">3591</span><br><span class="line">3592</span><br><span class="line">3593</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> next_offset = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arraysize</span>(wasm::kGpParamRegisters); ++i) &#123;</span><br><span class="line">  <span class="comment">// Check that &#123;params_start&#125; does not overlap with any of the parameter</span></span><br><span class="line">  <span class="comment">// registers, so that we don&#x27;t overwrite it by accident with the loads</span></span><br><span class="line">  <span class="comment">// below.</span></span><br><span class="line">  <span class="built_in">DCHECK_NE</span>(params_start, wasm::kGpParamRegisters[i]);</span><br><span class="line">  <span class="function">__ <span class="title">movq</span><span class="params">(wasm::kGpParamRegisters[i], MemOperand(params_start, next_offset))</span></span>;</span><br><span class="line">  next_offset += kSystemPointerSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arraysize</span>(wasm::kFpParamRegisters); ++i) &#123;</span><br><span class="line">  <span class="function">__ <span class="title">Movsd</span><span class="params">(wasm::kFpParamRegisters[i], MemOperand(params_start, next_offset))</span></span>;</span><br><span class="line">  next_offset += kDoubleSize;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">DCHECK_EQ</span>(next_offset, stack_params_offset);</span><br><span class="line"></span><br><span class="line">Register thread_in_wasm_flag_addr = r12;</span><br><span class="line"><span class="function">__ <span class="title">movq</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    thread_in_wasm_flag_addr,</span></span></span><br><span class="line"><span class="params"><span class="function">    MemOperand(kRootRegister, Isolate::thread_in_wasm_flag_address_offset()))</span></span>;</span><br><span class="line"><span class="function">__ <span class="title">movl</span><span class="params">(MemOperand(thread_in_wasm_flag_addr, <span class="number">0</span>), Immediate(<span class="number">1</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">__ <span class="title">call</span><span class="params">(call_target)</span></span>;</span><br></pre></td></tr></table></figure>

<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/7.png"></p>
<p>Then, <code>Builtins_JSToWasmWrapperAsm()</code> copies the parameters to the reserved registers, and jumps to the call target address.</p>
<h3 id="WebAssembly-Lazy-Compilation"><a href="#WebAssembly-Lazy-Compilation" class="headerlink" title="WebAssembly Lazy Compilation"></a>WebAssembly Lazy Compilation</h3><figure class="highlight c++"><figcaption><span>src&#x2F;flags&#x2F;flag-definitions.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1562</span><br><span class="line">1563</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DEFINE_BOOL</span>(wasm_lazy_compilation, <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;enable lazy compilation for all wasm modules&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/8.png"></p>
<p>With <code>wasm_lazy_compilation</code> enabled, WebAssembly functions are compiled when they are first called, rather than when the module is instantiated.</p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/9.png"></p>
<p>The jump table directs execution to <code>Builtins_WasmCompileLazy()</code> generated by <code>Builtins::Generate_WasmCompileLazy()</code>.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;x64&#x2F;builtins-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">3130</span><br><span class="line">3131</span><br><span class="line">3132</span><br><span class="line">3133</span><br><span class="line">3134</span><br><span class="line">3135</span><br><span class="line">3136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Push arguments for the runtime function.</span></span><br><span class="line"><span class="function">__ <span class="title">Push</span><span class="params">(kWasmInstanceRegister)</span></span>;</span><br><span class="line"><span class="function">__ <span class="title">Push</span><span class="params">(r15)</span></span>;</span><br><span class="line"><span class="comment">// Initialize the JavaScript context with 0. CEntry will use it to</span></span><br><span class="line"><span class="comment">// set the current context on the isolate.</span></span><br><span class="line"><span class="function">__ <span class="title">Move</span><span class="params">(kContextRegister, Smi::zero())</span></span>;</span><br><span class="line marked"><span class="function">__ <span class="title">CallRuntime</span><span class="params">(Runtime::kWasmCompileLazy, <span class="number">2</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>Builtins_WasmCompileLazy()</code> calls <code>Runtime_WasmCompileLazy()</code> to compile the function.</p>
<figure class="highlight c++"><figcaption><span>src&#x2F;wasm&#x2F;wasm-objects.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">375</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">DECL_PRIMITIVE_ACCESSORS</span>(jump_table_start, Address)</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>src&#x2F;builtins&#x2F;x64&#x2F;builtins-x64.cc</span></figcaption><table><tr><td class="gutter"><pre><span class="line">3143</span><br><span class="line">3144</span><br><span class="line">3145</span><br><span class="line">3146</span><br><span class="line">3147</span><br><span class="line">3148</span><br><span class="line">3149</span><br><span class="line">3150</span><br><span class="line">3151</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// After the instance register has been restored, we can add the jump table</span></span><br><span class="line">  <span class="comment">// start to the jump table offset already stored in r15.</span></span><br><span class="line">  <span class="function">__ <span class="title">addq</span><span class="params">(r15, MemOperand(kWasmInstanceRegister,</span></span></span><br><span class="line"><span class="params"><span class="function">                          wasm::ObjectAccess::ToTagged(</span></span></span><br><span class="line"><span class="params"><span class="function">                              WasmInstanceObject::kJumpTableStartOffset)))</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Finally, jump to the jump table slot for the function.</span></span><br><span class="line"><span class="function">__ <span class="title">jmp</span><span class="params">(r15)</span></span>;</span><br></pre></td></tr></table></figure>

<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/10.png"></p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/11.png"></p>
<p>After the compilation is finished, <code>Builtins_WasmCompileLazy()</code> retrieves the function’s jump table slot address from the <code>WasmInstanceObject</code>, and jumps to that address. This time, the jump table transfers control to the function’s compiled code.</p>
<p>Since the <code>WasmInstanceObject</code> resides within the V8 sandbox, we can hijack control flow by overwriting the <code>jump_table_start</code> field with an arbitrary address before lazy compilation proceeds.</p>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><p><a href="shellcode.py"><code>shellcode.py</code></a> <a href="pwn.wat"><code>pwn.wat</code></a> <a href="pwn.js"><code>pwn.js</code></a></p>
<p><img src="/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/pwn.png"></p>
<h2 id="Bisection"><a href="#Bisection" class="headerlink" title="Bisection"></a>Bisection</h2><blockquote><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://chromium.googlesource.com/v8/v8.git/+/29131d5e3ea9cbfeae3e6dc3fd6c4439f0ac4bde">[wasm] Enable lazy compilation by default</a> (Nov 14, 2022)</p>
</blockquote>

<p>This technique was introduced in the above commit, which enabled lazy compilation by default.</p>
<h2 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h2><blockquote><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://chromium.googlesource.com/v8/v8.git/+/59acab802a319da23c1c005e062fbc2bab4d348b">[wasm] Introduce WasmTrustedInstanceData</a> (Jan 4, 2024)<br>This CL moves most data from the WasmInstanceObject to a new WasmTrustedInstanceData. As the name suggests, this new object is allocated in the trusted space and can hence hold otherwise-unsafe data (like direct pointers). As the Wasm instance was still storing some unsafe pointers, this CL closes holes in the V8 sandbox, and allows us to land follow-up refactorings to remove more indirections for sandboxing (potentially after moving more data structures to the trusted space).<br>The general idea is that during execution we mostly work with the WasmTrustedInstanceData object. This is passed as a direct pointer to Wasm functions and is stored in Wasm frames. The WasmInstanceObject is the JS-exposed wrapper, which also holds user-defined properties and elements.</p>
</blockquote>

<p>The above commit moves some sensitive data including <code>jump_table_start</code> to the newly introduced <code>WasmTrustedInstanceData</code>, which resides outside the V8 sandbox. This prevents overwriting <code>jump_table_start</code> to hijack control flow.</p>

  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">Category</a></li>
        
          <li><a href="/tags/">Tag</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup"><span class="toc-number">1.</span> <span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Analysis"><span class="toc-number">2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Calling-WebAssembly-Function"><span class="toc-number">2.1.</span> <span class="toc-text">Calling WebAssembly Function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebAssembly-Lazy-Compilation"><span class="toc-number">2.2.</span> <span class="toc-text">WebAssembly Lazy Compilation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exploitation"><span class="toc-number">3.</span> <span class="toc-text">Exploitation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bisection"><span class="toc-number">4.</span> <span class="toc-text">Bisection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patch"><span class="toc-number">5.</span> <span class="toc-text">Patch</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&text=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&is_video=false&description=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)&body=Check out this article: https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&title=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&name=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://aaronsjcho.github.io/escaping-v8-sandbox-via-webassembly-jit-spraying-part-2/&t=Escaping V8 Sandbox via WebAssembly JIT Spraying: Part 2 (11.0.4 &lt;= V8 &lt; 12.2.170)"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2026
    Seongjoon (Aaron) Cho
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">Category</a></li><!--
     --><!--
       --><li><a href="/tags/">Tag</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'">


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'aaronsjcho/aaronsjcho.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          var utterances_thread = document.getElementById('utterances_thread');
          if (utterances_thread) { utterances_thread.appendChild(script); }
      }());
  </script>

</body>
</html>
